  
import json
import os

# ржХрж╛рж╕рзНржЯржо ржПрж░рж░
class InvalidPhoneNumberError(Exception):
     pass

class ContactBook:
    def __init__(self, filename='contacts.json'):
        self.filename = filename
        self.contacts = self._load_contacts()

    # --- ржлрж╛ржЗрж▓ рж╣рзНржпрж╛ржирзНржбрж▓рж┐ржВ (File Handling) ---

    def _load_contacts(self):
        """
        JSON ржлрж╛ржЗрж▓ ржерзЗржХрзЗ ржХржирзНржЯрж╛ржХрзНржЯ рж▓рзЛржб ржХрж░рзЗред
        ржлрж╛ржЗрж▓ ржирж╛ ржерж╛ржХрж▓рзЗ try-except ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХржЯрж┐ ржирждрзБржи ржЦрж╛рж▓рж┐ ржлрж╛ржЗрж▓ рждрзИрж░рж┐ред
        """
        try:
            with open(self.filename, 'r', encoding='utf-8') as file:
                # ржпржжрж┐ ржлрж╛ржЗрж▓ржЯрж┐ ржЦрж╛рж▓рж┐ ржерж╛ржХрзЗ, рждржмрзЗ {} рж░рж┐ржЯрж╛рж░рзНржи 
                data = file.read()
                if not data:
                    return []
                return json.loads(data)
        except FileNotFoundError:
            # ржлрж╛ржЗрж▓ ржирж╛ ржерж╛ржХрж▓рзЗ, ржПржХржЯрж┐ ржЦрж╛рж▓рж┐ рж▓рж┐рж╕рзНржЯ ржжрж┐рзЯрзЗ рж╢рзБрж░рзБ ржХрж░рзЛ ржПржмржВ ржлрж╛ржЗрж▓ржЯрж┐ рждрзИрж░рж┐ 
            self._save_contacts([])
            return []
        except json.JSONDecodeError:
            # ржпржжрж┐ ржлрж╛ржЗрж▓ ржерж╛ржХрзЗ ржХрж┐ржирзНрждрзБ JSON ржлрж░ржорзНржпрж╛ржЯ ржнрзБрж▓ рж╣рзЯ
            print(f"  тЪая╕П Error: '{self.filename}' ржлрж╛ржЗрж▓рзЗ ржбрзЗржЯрж╛ ржлрж░ржорзНржпрж╛ржЯ ржнрзБрж▓ред ржЦрж╛рж▓рж┐ ржХржирзНржЯрж╛ржХрзНржЯ ржмрзБржХ рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред")
            return []

    def _save_contacts(self, contacts_list):
        """ржмрж░рзНрждржорж╛ржи ржХржирзНржЯрж╛ржХрзНржЯ рж▓рж┐рж╕рзНржЯ JSON ржлрж╛ржЗрж▓рзЗ рж╕рзЗржн ржХрж░рзЗред"""
        with open(self.filename, 'w', encoding='utf-8') as file:
            json.dump(contacts_list, file, indent=4, ensure_ascii=False)

    # --- ржлрзЛржи ржиржорзНржмрж░ ржнрзНржпрж╛рж▓рж┐ржбрзЗрж╢ржи (Phone Number Validation) ---

    def _validate_phone(self, phone):
        """
        ржлрзЛржи ржиржорзНржмрж░ ржнрзНржпрж╛рж▓рж┐ржбрзЗржЯ ржХрж░рзЗред
        рж░рж┐ржХрзЛрзЯрж╛рж░ржорзЗржирзНржЯ: рж╕ржВржЦрзНржпрж╛ ржЫрж╛рзЬрж╛ ржЕржирзНржп ржХрж┐ржЫрзБ ржжрж┐рж▓рзЗ ржХрж╛рж╕рзНржЯржо ржПрж░рж░ raise ржХрж░ржмрзЗред
        """
        # рж╢рзБржзрзБржорж╛рждрзНрж░ рж╕ржВржЦрзНржпрж╛  ржЖржЫрзЗ ржХрж┐ ржирж╛ рждрж╛ ржЪрзЗржХ ржХрж░рж╛ 
        if not phone.isdigit():
            raise InvalidPhoneNumberError("  ржлрзЛржи ржиржорзНржмрж░рзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ рж╕ржВржЦрзНржпрж╛  ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗредЁЯФв")
        
        # ржлрзЛржи ржиржорзНржмрж░ ржЗржЙржирж┐ржХ ржХрж┐ ржирж╛ рждрж╛ ржЪрзЗржХ ржХрж░рж╛ 
        if any(contact['phone'] == phone for contact in self.contacts):
            raise InvalidPhoneNumberError("  ржПржЗ ржлрзЛржи ржиржорзНржмрж░ржЯрж┐ ржХржирзНржЯрж╛ржХрзНржЯ ржмрзБржХрзЗ ржЖржЧрзЗ ржерзЗржХрзЗржЗ ржмрж┐ржжрзНржпржорж╛ржиредЁЯЪл")

    # --- ржХржирзНржЯрж╛ржХрзНржЯ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ ржлрж╛ржВрж╢ржи (Contact Management Functions) ---

    def add_contact(self, name, phone):
        """ржПржХржЯрж┐ ржирждрзБржи ржХржирзНржЯрж╛ржХрзНржЯ ржпрзБржХрзНржд ржХрж░рзЗ ржПржмржВ ржлрж╛ржЗрж▓ рж╕рзЗржн ржХрж░рзЗред"""
        try:
            # ржнрзНржпрж╛рж▓рж┐ржбрзЗрж╢ржи ржЪрзЗржХ
            self._validate_phone(phone)
            
            new_contact = {
                "name": name.strip(),
                "phone": phone.strip()
            }
            
            self.contacts.append(new_contact)
            self._save_contacts(self.contacts)
            print(f"\n  тЬЕ ржХржирзНржЯрж╛ржХрзНржЯ ржпрзБржХрзНржд рж╣рзЯрзЗржЫрзЗ: {name} ({phone}) ЁЯТ╛")

        except InvalidPhoneNumberError as e:
            print(f"\n  тЭМ ржХржирзНржЯрж╛ржХрзНржЯ ржпрзБржХрзНржд ржХрж░рж╛ ржпрж╛рзЯржирж┐: {e}")
            
    def view_contacts(self):
        """рж╕ржм ржХржирзНржЯрж╛ржХрзНржЯ ржкрзНрж░рж┐ржирзНржЯ ржХрж░рзЗред"""
        if not self.contacts:
            print("\n  тД╣я╕П ржХржирзНржЯрж╛ржХрзНржЯ ржмрзБржХрзЗ ржХрзЛржирзЛ ржПржирзНржЯрзНрж░рж┐ ржирзЗржЗред")
            return

        print("------------------------------------")
        print("\n----------- ЁЯУЮ ржХржирзНржЯрж╛ржХрзНржЯ рж▓рж┐рж╕рзНржЯ -----------")
        for i, contact in enumerate(self.contacts, 1):
            print(f"  {i}. ржирж╛ржо: {contact['name']}, ржлрзЛржи: {contact['phone']}")
        print("\n------------------------------------")

    def delete_contact(self, phone):
        """ржлрзЛржи ржиржорзНржмрж░ ржжрж┐рзЯрзЗ ржХржирзНржЯрж╛ржХрзНржЯ ржорзБржЫрзЗ ржлрзЗрж▓рзЗред"""
        initial_count = len(self.contacts)
        
        # ржпрзЗ ржлрзЛржи ржиржорзНржмрж░ржЯрж┐ ржорзБржЫрждрзЗ рж╣ржмрзЗ, рждрж╛ ржмрж╛ржжрзЗ ржмрж╛ржХрж┐ ржХржирзНржЯрж╛ржХрзНржЯржЧрзБрж▓рзЛ ржирж┐рзЯрзЗ ржирждрзБржи рж▓рж┐рж╕рзНржЯ рждрзИрж░рж┐ ржХрж░рж╛
        self.contacts = [c for c in self.contacts if c['phone'] != phone]
        
        if len(self.contacts) < initial_count:
            self._save_contacts(self.contacts)
            print(f"\n  тЬЕ ржлрзЛржи ржиржорзНржмрж░ {phone} рж╕рж╣ ржХржирзНржЯрж╛ржХрзНржЯржЯрж┐ ржорзБржЫрзЗ ржлрзЗрж▓рж╛ рж╣рзЯрзЗржЫрзЗред")
        else:
            print(f"\n  тЭМ ржлрзЛржи ржиржорзНржмрж░ {phone} ржЦрзБржБржЬрзЗ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐редтЪая╕П")


# --- ржорзЗржЗржи ржкрзНрж░рзЛржЧрзНрж░рж╛ржо рж▓ржЬрж┐ржХ (Main Program Logic) ---

def main():
    contact_book = ContactBook()

    while True:
        print("====================================")
        print("        тЩ╗я╕П Mini project 9 ЁЯМР     ")
        print(" ЁЯЫая╕П Developer ЁЯФз MD IMRAN HOSSEN тЪЩя╕Пя╕П")
        print("====================================")
        print("         ЁЯУ╢ Contract book ЁЯУС")
        print("====================================")
        print(" \n  === ржХржирзНржЯрж╛ржХрзНржЯ ржмрзБржХ ===")
        print("  1. ржХржирзНржЯрж╛ржХрзНржЯ ржпрзБржХрзНржд ржХрж░рзБржи тШОя╕П")
        print("  2. рж╕ржм ржХржирзНржЯрж╛ржХрзНржЯ ржжрзЗржЦрзБржи ЁЯУЛ")
        print("  3. ржХржирзНржЯрж╛ржХрзНржЯ ржорзБржЫрзБржи тЫФ(ржлрзЛржи ржиржорзНржмрж░ ржжрзНржмрж╛рж░рж╛ ЁЯФв")
        print("  4. ржПржХрзНрж╕рж┐ржЯ (Exit) ржХрж░рзБржи ЁЯУ┤")
        print("====================================")
        
        choice = input("  ржЖржкржирж╛рж░ ржЕржкрж╢ржи ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи тПпя╕П(1-4): ").strip()
        print()  
        if choice == '1':
            name = input("  ЁЯУЭржирж╛ржо:* ")
            phone = input("  тШОя╕ПржлрзЛржи ржиржорзНржмрж░:* ")
            contact_book.add_contact(name, phone)
            
        elif choice == '2':
            contact_book.view_contacts()
            
        elif choice == '3':
            phone_to_delete = input("  ржорзБржЫрзЗ ржлрзЗрж▓рж╛рж░ ржЬржирзНржп ржлрзЛржи ржиржорзНржмрж░ ржжрж┐ржи тЫФ: ")
            contact_book.delete_contact(phone_to_delete)
            
        elif choice == '4':
            print("\n. ЁЯСЛ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржмржирзНржз рж╣ржЪрзНржЫрзЗ ЁЯУ┤ !")
            break
            
        else:
            print("\n  тЭМ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржи тЩ╗я╕Пред")

if __name__ == "__main__":
    main()